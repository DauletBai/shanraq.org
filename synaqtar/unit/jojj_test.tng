// jojj_test.tng - JOJJ –æ–ø–µ—Ä–∞—Ü–∏—è–ª–∞—Ä—ã —Ç–µ—Å—Ç—Ç–µ—Ä—ñ
// JOJJ Operations Tests

import "framework/jojj/jojj_interface.tng";
import "ƒ±sker_qisyn/paydalanu_baskaru/paydalanusylar_jojj.tng";
import "ƒ±sker_qisyn/mazmun_baskaru/maqalalar_jojj.tng";
import "ƒ±sker_qisyn/mazmun_baskaru/sanattar_jojj.tng";

// JOJJ —Ç–µ—Å—Ç—Ç–µ—Ä—ñ
atqar jojj_test_jasau() -> TestSuite {
    jasau test_suite: TestSuite = test_suite_jasau("JOJJ Operations Tests");
    qaytar test_suite;
}

// –¢–µ—Å—Ç –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã–ª–∞—Ä JOJJ –æ–ø–µ—Ä–∞—Ü–∏—è–ª–∞—Ä—ã
atqar test_paydalanusylar_jojj() -> aqƒ±qat {
    korset("üß™ –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–ª–∞—Ä JOJJ —Ç–µ—Å—Ç—Ç–µ—Ä—ñ–Ω —ñ—Å–∫–µ “õ–æ—Å—É...");
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    jasau connection: DatabaseConnection = sqlite_connection_jasau("test.db");
    jasau paydalanusylar: PaydalanusylarJOJJ = new PaydalanusylarJOJJ(connection);
    
    // Jasau - –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã –∂–∞—Å–∞—É
    jasau create_result: JsonObject = paydalanusylar.paydalanu_jasau(
        "Test User",
        "test@example.com",
        "password123",
        "user"
    );
    
    e–≥–µ—Ä (!json_object_get_boolean(create_result, "success")) {
        korset("‚ùå –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã –∂–∞—Å–∞—É “õ–∞—Ç–µ—Å—ñ: " + json_object_get_string(create_result, "error"));
        qaytar jin;
    }
    
    jasau user: JsonObject = json_object_get_object(create_result, "entity");
    jasau user_id: jol = json_object_get_string(user, "id");
    
    // Oqu - –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã –∞–ª—É
    jasau read_result: JsonObject = paydalanusylar.paydalanu_oqu(user_id);
    
    e–≥–µ—Ä (read_result == NULL) {
        korset("‚ùå –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã –∞–ª—É “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    // Janartu - –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã –∂–∞“£–∞—Ä—Ç—É
    jasau update_result: JsonObject = paydalanusylar.paydalanu_janartu(
        user_id,
        "Updated Test User",
        "updated@example.com",
        "admin",
        "active"
    );
    
    e–≥–µ—Ä (!json_object_get_boolean(update_result, "success")) {
        korset("‚ùå –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã –∂–∞“£–∞—Ä—Ç—É “õ–∞—Ç–µ—Å—ñ: " + json_object_get_string(update_result, "error"));
        qaytar jin;
    }
    
    // Joiu - –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã –∂–æ—é
    jasau delete_result: aqƒ±qat = paydalanusylar.paydalanu_joiu(user_id);
    
    e–≥–µ—Ä (!delete_result) {
        korset("‚ùå –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã –∂–æ—é “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    korset("‚úÖ –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–ª–∞—Ä JOJJ —Ç–µ—Å—Ç—Ç–µ—Ä—ñ —Å”ô—Ç—Ç—ñ ”©—Ç—Ç—ñ");
    qaytar jan;
}

// –¢–µ—Å—Ç –º–∞“õ–∞–ª–∞–ª–∞—Ä JOJJ –æ–ø–µ—Ä–∞—Ü–∏—è–ª–∞—Ä—ã
atqar test_maqalalar_jojj() -> aqƒ±qat {
    korset("üß™ –ú–∞“õ–∞–ª–∞–ª–∞—Ä JOJJ —Ç–µ—Å—Ç—Ç–µ—Ä—ñ–Ω —ñ—Å–∫–µ “õ–æ—Å—É...");
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    jasau connection: DatabaseConnection = sqlite_connection_jasau("test.db");
    jasau maqalalar: MaqalalarJOJJ = new MaqalalarJOJJ(connection);
    
    // –°–æ–∑–¥–∞–µ–º –∞–≤—Ç–æ—Ä–∞
    jasau author_id: jol = "author123";
    
    // Jasau - –ú–∞“õ–∞–ª–∞ –∂–∞—Å–∞—É
    jasau create_result: JsonObject = maqalalar.maqala_jasau(
        "Test Article",
        "This is a test article content",
        author_id,
        "",
        "published"
    );
    
    e–≥–µ—Ä (!json_object_get_boolean(create_result, "success")) {
        korset("‚ùå –ú–∞“õ–∞–ª–∞ –∂–∞—Å–∞—É “õ–∞—Ç–µ—Å—ñ: " + json_object_get_string(create_result, "error"));
        qaytar jin;
    }
    
    jasau article: JsonObject = json_object_get_object(create_result, "entity");
    jasau article_id: jol = json_object_get_string(article, "id");
    
    // Oqu - –ú–∞“õ–∞–ª–∞–Ω—ã –∞–ª—É
    jasau read_result: JsonObject = maqalalar.maqala_oqu(article_id);
    
    e–≥–µ—Ä (read_result == NULL) {
        korset("‚ùå –ú–∞“õ–∞–ª–∞–Ω—ã –∞–ª—É “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    // Janartu - –ú–∞“õ–∞–ª–∞–Ω—ã –∂–∞“£–∞—Ä—Ç—É
    jasau update_result: JsonObject = maqalalar.maqala_janartu(
        article_id,
        "Updated Test Article",
        "Updated article content",
        "",
        "draft"
    );
    
    e–≥–µ—Ä (!json_object_get_boolean(update_result, "success")) {
        korset("‚ùå –ú–∞“õ–∞–ª–∞–Ω—ã –∂–∞“£–∞—Ä—Ç—É “õ–∞—Ç–µ—Å—ñ: " + json_object_get_string(update_result, "error"));
        qaytar jin;
    }
    
    // Joiu - –ú–∞“õ–∞–ª–∞–Ω—ã –∂–æ—é
    jasau delete_result: aqƒ±qat = maqalalar.maqala_joiu(article_id);
    
    e–≥–µ—Ä (!delete_result) {
        korset("‚ùå –ú–∞“õ–∞–ª–∞–Ω—ã –∂–æ—é “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    korset("‚úÖ –ú–∞“õ–∞–ª–∞–ª–∞—Ä JOJJ —Ç–µ—Å—Ç—Ç–µ—Ä—ñ —Å”ô—Ç—Ç—ñ ”©—Ç—Ç—ñ");
    qaytar jan;
}

// –¢–µ—Å—Ç —Å–∞–Ω–∞—Ç—Ç–∞—Ä JOJJ –æ–ø–µ—Ä–∞—Ü–∏—è–ª–∞—Ä—ã
atqar test_sanattar_jojj() -> aqƒ±qat {
    korset("üß™ –°–∞–Ω–∞—Ç—Ç–∞—Ä JOJJ —Ç–µ—Å—Ç—Ç–µ—Ä—ñ–Ω —ñ—Å–∫–µ “õ–æ—Å—É...");
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    jasau connection: DatabaseConnection = sqlite_connection_jasau("test.db");
    jasau sanattar: SanattarJOJJ = new SanattarJOJJ(connection);
    
    // Jasau - –°–∞–Ω–∞—Ç –∂–∞—Å–∞—É
    jasau create_result: JsonObject = sanattar.sanat_jasau(
        "Test Category",
        "This is a test category",
        "",
        "#ff0000",
        "icon-test"
    );
    
    e–≥–µ—Ä (!json_object_get_boolean(create_result, "success")) {
        korset("‚ùå –°–∞–Ω–∞—Ç –∂–∞—Å–∞—É “õ–∞—Ç–µ—Å—ñ: " + json_object_get_string(create_result, "error"));
        qaytar jin;
    }
    
    jasau category: JsonObject = json_object_get_object(create_result, "entity");
    jasau category_id: jol = json_object_get_string(category, "id");
    
    // Oqu - –°–∞–Ω–∞—Ç—Ç—ã –∞–ª—É
    jasau read_result: JsonObject = sanattar.sanat_oqu(category_id);
    
    e–≥–µ—Ä (read_result == NULL) {
        korset("‚ùå –°–∞–Ω–∞—Ç—Ç—ã –∞–ª—É “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    // Janartu - –°–∞–Ω–∞—Ç—Ç—ã –∂–∞“£–∞—Ä—Ç—É
    jasau update_result: JsonObject = sanattar.sanat_janartu(
        category_id,
        "Updated Test Category",
        "Updated category description",
        "",
        "#00ff00",
        "icon-updated",
        1
    );
    
    e–≥–µ—Ä (!json_object_get_boolean(update_result, "success")) {
        korset("‚ùå –°–∞–Ω–∞—Ç—Ç—ã –∂–∞“£–∞—Ä—Ç—É “õ–∞—Ç–µ—Å—ñ: " + json_object_get_string(update_result, "error"));
        qaytar jin;
    }
    
    // Joiu - –°–∞–Ω–∞—Ç—Ç—ã –∂–æ—é
    jasau delete_result: aqƒ±qat = sanattar.sanat_joiu(category_id);
    
    e–≥–µ—Ä (!delete_result) {
        korset("‚ùå –°–∞–Ω–∞—Ç—Ç—ã –∂–æ—é “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    korset("‚úÖ –°–∞–Ω–∞—Ç—Ç–∞—Ä JOJJ —Ç–µ—Å—Ç—Ç–µ—Ä—ñ —Å”ô—Ç—Ç—ñ ”©—Ç—Ç—ñ");
    qaytar jan;
}

// –¢–µ—Å—Ç JOJJ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
atqar test_jojj_interface() -> aqƒ±qat {
    korset("üß™ JOJJ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–µ—Å—Ç—Ç–µ—Ä—ñ–Ω —ñ—Å–∫–µ “õ–æ—Å—É...");
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    jasau connection: DatabaseConnection = sqlite_connection_jasau("test.db");
    jasau jojj: JOJJBase = jojj_factory_jasau("test_table", connection);
    
    // –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
    jasau entity: JsonObject = json_object_create();
    json_object_set_string(entity, "name", "Test Entity");
    json_object_set_string(entity, "description", "Test description");
    
    jasau create_result: JsonObject = jojj.jasau(entity);
    
    e–≥–µ—Ä (!json_object_get_boolean(create_result, "success")) {
        korset("‚ùå JOJJ –∂–∞—Å–∞—É “õ–∞—Ç–µ—Å—ñ: " + json_object_get_string(create_result, "error"));
        qaytar jin;
    }
    
    jasau created_entity: JsonObject = json_object_get_object(create_result, "entity");
    jasau entity_id: jol = json_object_get_string(created_entity, "id");
    
    // –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
    jasau read_result: JsonObject = jojj.oqu(entity_id);
    
    e–≥–µ—Ä (read_result == NULL) {
        korset("‚ùå JOJJ –æ“õ—É “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    // –¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
    jasau update_data: JsonObject = json_object_create();
    json_object_set_string(update_data, "name", "Updated Test Entity");
    
    jasau update_result: JsonObject = jojj.janartu(entity_id, update_data);
    
    e–≥–µ—Ä (!json_object_get_boolean(update_result, "success")) {
        korset("‚ùå JOJJ –∂–∞“£–∞—Ä—Ç—É “õ–∞—Ç–µ—Å—ñ: " + json_object_get_string(update_result, "error"));
        qaytar jin;
    }
    
    // –¢–µ—Å—Ç —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
    jasau delete_result: aqƒ±qat = jojj.joiu(entity_id);
    
    e–≥–µ—Ä (!delete_result) {
        korset("‚ùå JOJJ –∂–æ—é “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    korset("‚úÖ JOJJ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–µ—Å—Ç—Ç–µ—Ä—ñ —Å”ô—Ç—Ç—ñ ”©—Ç—Ç—ñ");
    qaytar jan;
}

// –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
atqar test_jojj_validation() -> aqƒ±qat {
    korset("üß™ JOJJ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ—Å—Ç—Ç–µ—Ä—ñ–Ω —ñ—Å–∫–µ “õ–æ—Å—É...");
    
    // –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    jasau user_validation: JsonObject = paydalanu_tekseu_jasau("", "invalid-email", "123");
    
    e–≥–µ—Ä (json_object_get_boolean(user_validation, "valid")) {
        korset("‚ùå –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã –≤–∞–ª–∏–¥–∞—Ü–∏—è “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    // –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç–∞—Ç—å–∏
    jasau article_validation: JsonObject = maqala_tekseu_jasau("", "");
    
    e–≥–µ—Ä (json_object_get_boolean(article_validation, "valid")) {
        korset("‚ùå –ú–∞“õ–∞–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    // –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    jasau category_validation: JsonObject = sanat_tekseu_jasau("", "");
    
    e–≥–µ—Ä (json_object_get_boolean(category_validation, "valid")) {
        korset("‚ùå –°–∞–Ω–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    korset("‚úÖ JOJJ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ—Å—Ç—Ç–µ—Ä—ñ —Å”ô—Ç—Ç—ñ ”©—Ç—Ç—ñ");
    qaytar jan;
}

// –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö JOJJ —Ç–µ—Å—Ç–æ–≤
atqar jojj_testlerin_ishke_engizu() {
    korset("üß™ JOJJ —Ç–µ—Å—Ç—Ç–µ—Ä—ñ–Ω —ñ—Å–∫–µ “õ–æ—Å—É...");
    korset("=====================================================");
    
    jasau passed: san = 0;
    jasau total: san = 5;
    
    e–≥–µ—Ä (test_paydalanusylar_jojj()) {
        passed = passed + 1;
    }
    
    e–≥–µ—Ä (test_maqalalar_jojj()) {
        passed = passed + 1;
    }
    
    e–≥–µ—Ä (test_sanattar_jojj()) {
        passed = passed + 1;
    }
    
    e–≥–µ—Ä (test_jojj_interface()) {
        passed = passed + 1;
    }
    
    e–≥–µ—Ä (test_jojj_validation()) {
        passed = passed + 1;
    }
    
    korset("üìä JOJJ —Ç–µ—Å—Ç –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ: " + passed + "/" + total + " ”©—Ç—Ç—ñ");
    korset("=====================================================");
    
    e–≥–µ—Ä (passed == total) {
        korset("‚úÖ –ë–∞—Ä–ª—ã“õ JOJJ —Ç–µ—Å—Ç—Ç–µ—Ä—ñ —Å”ô—Ç—Ç—ñ ”©—Ç—Ç—ñ!");
        korset("üéâ JOJJ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ —Ç–æ–ª—ã“õ –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ!");
    } aitpese {
        korset("‚ùå –ö–µ–π–±—ñ—Ä JOJJ —Ç–µ—Å—Ç—Ç–µ—Ä—ñ —Å”ô—Ç—Å—ñ–∑!");
    }
}
