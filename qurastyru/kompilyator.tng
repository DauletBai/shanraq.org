// kompilyator.tng - Tenge –Ω–µ–≥—ñ–∑–≥—ñ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä
// –ê–≥–≥–ª—é—Ç–∏–Ω–∞—Ç–∏–≤—Ç—ñ–∫ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä

atqar kompilyator_jasau() -> Compiler {
    jasau compiler: Compiler = compiler_create();
    qaytar compiler;
}

// Tenge –∫–æ–¥—Ç—ã –∫–æ–º–ø–∏–ª—è—Ü–∏—è–ª–∞—É
atqar kompilyator_compile(compiler: Compiler, source_code: jol, output_filename: jol) -> aqƒ±qat {
    korset("Tenge –∫–æ–¥—Ç—ã –∫–æ–º–ø–∏–ª—è—Ü–∏—è–ª–∞—É –±–∞—Å—Ç–∞–ª–¥—ã...");
    
    // 1. –õ–µ–∫—Å–µ—Ä - –∫–æ–¥–¥—ã —Ç–æ–∫–µ–Ω–¥–µ—Ä–≥–µ –±”©–ª—É
    korset("1. –õ–µ–∫—Å–µ—Ä —ñ—Å–∫–µ “õ–æ—Å—ã–ª–¥—ã...");
    jasau lexer: Lexer = lekser_jasau();
    jasau tokens: Token[] = lekser_tokenize(lexer, source_code);
    
    e–≥–µ—Ä (tokens.length == 0) {
        korset("‚ùå –õ–µ–∫—Å–µ—Ä “õ–∞—Ç–µ—Å—ñ: —Ç–æ–∫–µ–Ω–¥–µ—Ä —Ç–∞–±—ã–ª–º–∞–¥—ã");
        qaytar jin;
    }
    
    korset("‚úÖ " + tokens.length + " —Ç–æ–∫–µ–Ω —Ç–∞–±—ã–ª–¥—ã");
    
    // 2. –ü–∞—Ä—Å–µ—Ä - —Ç–æ–∫–µ–Ω–¥–µ—Ä–¥—ñ AST-“õ–∞ —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É
    korset("2. –ü–∞—Ä—Å–µ—Ä —ñ—Å–∫–µ “õ–æ—Å—ã–ª–¥—ã...");
    jasau parser: Parser = parser_jasau();
    jasau ast: AST = parser_parse(parser, tokens);
    
    e–≥–µ—Ä (ast.nodes.length == 0) {
        korset("‚ùå –ü–∞—Ä—Å–µ—Ä “õ–∞—Ç–µ—Å—ñ: AST node-–¥–∞—Ä—ã —Ç–∞–±—ã–ª–º–∞–¥—ã");
        qaytar jin;
    }
    
    korset("‚úÖ " + ast.nodes.length + " AST node —Ç–∞–±—ã–ª–¥—ã");
    
    // 3. –¢—Ä–∞–Ω—Å–ø–∞–π–ª–µ—Ä - AST-—Ç—ã C –∫–æ–¥“õ–∞ —Ç“Ø—Ä–ª–µ–Ω–¥—ñ—Ä—É
    korset("3. –¢—Ä–∞–Ω—Å–ø–∞–π–ª–µ—Ä —ñ—Å–∫–µ “õ–æ—Å—ã–ª–¥—ã...");
    jasau transpiler: Transpiler = transpiler_jasau();
    jasau c_code: jol = transpiler_transpile(transpiler, ast);
    
    e–≥–µ—Ä (c_code == "") {
        korset("‚ùå –¢—Ä–∞–Ω—Å–ø–∞–π–ª–µ—Ä “õ–∞—Ç–µ—Å—ñ: C –∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è–ª–∞–Ω–±–∞–¥—ã");
        qaytar jin;
    }
    
    korset("‚úÖ C –∫–æ–¥ —Å”ô—Ç—Ç—ñ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è–ª–∞–Ω–¥—ã");
    
    // 4. C –∫–æ–¥—Ç—ã —Ñ–∞–π–ª“ì–∞ –∂–∞–∑—É
    korset("4. C –∫–æ–¥—Ç—ã —Ñ–∞–π–ª“ì–∞ –∂–∞–∑—É...");
    jasau c_filename: jol = output_filename + ".c";
    jasau write_success: aqƒ±qat = transpiler_write_to_file(c_code, c_filename);
    
    e–≥–µ—Ä (!write_success) {
        korset("‚ùå C –∫–æ–¥—Ç—ã —Ñ–∞–π–ª“ì–∞ –∂–∞–∑—É “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    korset("‚úÖ C –∫–æ–¥ " + c_filename + " —Ñ–∞–π–ª—ã–Ω–∞ –∂–∞–∑—ã–ª–¥—ã");
    
    // 5. C –∫–æ–¥—Ç—ã –∫–æ–º–ø–∏–ª—è—Ü–∏—è–ª–∞—É
    korset("5. C –∫–æ–¥—Ç—ã –∫–æ–º–ø–∏–ª—è—Ü–∏—è–ª–∞—É...");
    jasau compile_success: aqƒ±qat = transpiler_compile_c_code(c_filename, output_filename);
    
    e–≥–µ—Ä (!compile_success) {
        korset("‚ùå C –∫–æ–¥—Ç—ã –∫–æ–º–ø–∏–ª—è—Ü–∏—è–ª–∞—É “õ–∞—Ç–µ—Å—ñ");
        qaytar jin;
    }
    
    korset("‚úÖ " + output_filename + " —Å”ô—Ç—Ç—ñ “õ“±—Ä–∞—Å—Ç—ã—Ä—ã–ª–¥—ã");
    korset("üéâ –ö–æ–º–ø–∏–ª—è—Ü–∏—è –∞—è“õ—Ç–∞–ª–¥—ã!");
    
    qaytar jan;
}

// –§–∞–π–ª–¥–∞–Ω Tenge –∫–æ–¥—Ç—ã –æ“õ—É
atqar kompilyator_read_file(filename: jol) -> jol {
    jasau file: FILE = fopen(filename, "r");
    
    e–≥–µ—Ä (file == NULL) {
        korset("‚ùå –§–∞–π–ª–¥—ã –∞—à—É “õ–∞—Ç–µ—Å—ñ: " + filename);
        qaytar "";
    }
    
    jasau content: jol = "";
    jasau buffer: jol[1024];
    
    azirshe (fgets(buffer, sizeof(buffer), file) != NULL) {
        content = content + buffer;
    }
    
    fclose(file);
    qaytar content;
}

// –ö–æ–¥–¥—ã —Ç–µ–∫—Å–µ—Ä—É (linting)
atqar kompilyator_lint(compiler: Compiler, source_code: jol) -> LintResult {
    jasau result: LintResult = lint_result_create();
    
    // –°–∏–Ω—Ç–∞–∫—Å “õ–∞—Ç–µ–ª–µ—Ä—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É
    jasau syntax_errors: LintError[] = kompilyator_check_syntax(source_code);
    result.errors = result.errors + syntax_errors;
    
    // –°—Ç–∏–ª—å “õ–∞—Ç–µ–ª–µ—Ä—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É
    jasau style_errors: LintError[] = kompilyator_check_style(source_code);
    result.errors = result.errors + style_errors;
    
    // –ê–≥–≥–ª—é—Ç–∏–Ω–∞—Ç–∏–≤—Ç—ñ–∫ –µ—Ä–µ–∂–µ–ª–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä—É
    jasau agglutinative_errors: LintError[] = kompilyator_check_agglutinative_rules(source_code);
    result.errors = result.errors + agglutinative_errors;
    
    result.success = result.errors.length == 0;
    qaytar result;
}

// –°–∏–Ω—Ç–∞–∫—Å “õ–∞—Ç–µ–ª–µ—Ä—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É
atqar kompilyator_check_syntax(source_code: jol) -> LintError[] {
    jasau errors: LintError[] = [];
    
    // –ñ–∞“õ—à–∞–ª–∞—Ä–¥—ã —Ç–µ–∫—Å–µ—Ä—É
    jasau brace_errors: LintError[] = kompilyator_check_braces(source_code);
    errors = errors + brace_errors;
    
    // –ù“Ø–∫—Ç–µ–ª—ñ “Ø—Ç—ñ—Ä–ª–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä—É
    jasau semicolon_errors: LintError[] = kompilyator_check_semicolons(source_code);
    errors = errors + semicolon_errors;
    
    // –ö—ñ–ª—Ç —Å”©–∑–¥–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä—É
    jasau keyword_errors: LintError[] = kompilyator_check_keywords(source_code);
    errors = errors + keyword_errors;
    
    qaytar errors;
}

// –ñ–∞“õ—à–∞–ª–∞—Ä–¥—ã —Ç–µ–∫—Å–µ—Ä—É
atqar kompilyator_check_braces(source_code: jol) -> LintError[] {
    jasau errors: LintError[] = [];
    jasau brace_stack: jol[] = [];
    jasau line: san = 1;
    jasau column: san = 1;
    jasau i: san = 0;
    
    azirshe (i < source_code.length) {
        jasau char: jol = source_code[i];
        
        e–≥–µ—Ä (char == '{') {
            brace_stack = brace_stack + ["{"];
        } aitpese e–≥–µ—Ä (char == '}') {
            e–≥–µ—Ä (brace_stack.length == 0) {
                jasau error: LintError = lint_error_create();
                error.message = "–ö–µ—Ä–µ–∫—Å—ñ–∑ '}' –∂–∞“õ—à–∞—Å—ã";
                error.line = line;
                error.column = column;
                errors = errors + [error];
            } aitpese {
                brace_stack = brace_stack[0:brace_stack.length-1];
            }
        } aitpese e–≥–µ—Ä (char == '(') {
            brace_stack = brace_stack + ["("];
        } aitpese e–≥–µ—Ä (char == ')') {
            e–≥–µ—Ä (brace_stack.length == 0) {
                jasau error: LintError = lint_error_create();
                error.message = "–ö–µ—Ä–µ–∫—Å—ñ–∑ ')' –∂–∞“õ—à–∞—Å—ã";
                error.line = line;
                error.column = column;
                errors = errors + [error];
            } aitpese {
                brace_stack = brace_stack[0:brace_stack.length-1];
            }
        }
        
        e–≥–µ—Ä (char == '\n') {
            line = line + 1;
            column = 1;
        } aitpese {
            column = column + 1;
        }
        
        i = i + 1;
    }
    
    // –ê—à—ã“õ –∂–∞“õ—à–∞–ª–∞—Ä–¥—ã —Ç–µ–∫—Å–µ—Ä—É
    azirshe (brace_stack.length > 0) {
        jasau error: LintError = lint_error_create();
        error.message = "–ê—à—ã“õ –∂–∞“õ—à–∞–ª–∞—Ä: " + brace_stack[brace_stack.length-1];
        error.line = line;
        error.column = column;
        errors = errors + [error];
        brace_stack = brace_stack[0:brace_stack.length-1];
    }
    
    qaytar errors;
}

// –ù“Ø–∫—Ç–µ–ª—ñ “Ø—Ç—ñ—Ä–ª–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä—É
atqar kompilyator_check_semicolons(source_code: jol) -> LintError[] {
    jasau errors: LintError[] = [];
    jasau lines: jol[] = string_split(source_code, "\n");
    jasau i: san = 0;
    
    azirshe (i < lines.length) {
        jasau line: jol = lines[i];
        jasau trimmed_line: jol = string_trim(line);
        
        // –ë–æ—Å –∂–æ–ª–¥–∞—Ä–¥—ã ”©—Ç–∫—ñ–∑—É
        e–≥–µ—Ä (trimmed_line == "" || trimmed_line.startsWith("//") || trimmed_line.startsWith("/*")) {
            i = i + 1;
            davam_et;
        }
        
        // –ö–µ–π–±—ñ—Ä statement-—Ç–∞—Ä –Ω“Ø–∫—Ç–µ–ª—ñ “Ø—Ç—ñ—Ä “õ–∞–∂–µ—Ç –µ—Ç–ø–µ–π–¥—ñ
        e–≥–µ—Ä (!trimmed_line.endsWith(";") && !trimmed_line.endsWith("{") && 
              !trimmed_line.endsWith("}") && !trimmed_line.startsWith("atqar") &&
              !trimmed_line.startsWith("jasau") && !trimmed_line.startsWith("eger") &&
              !trimmed_line.startsWith("azirshe") && !trimmed_line.startsWith("korset")) {
            
            jasau error: LintError = lint_error_create();
            error.message = "–ù“Ø–∫—Ç–µ–ª—ñ “Ø—Ç—ñ—Ä –∂–æ“õ";
            error.line = i + 1;
            error.column = trimmed_line.length;
            errors = errors + [error];
        }
        
        i = i + 1;
    }
    
    qaytar errors;
}

// –ö—ñ–ª—Ç —Å”©–∑–¥–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä—É
atqar kompilyator_check_keywords(source_code: jol) -> LintError[] {
    jasau errors: LintError[] = [];
    jasau lines: jol[] = string_split(source_code, "\n");
    jasau i: san = 0;
    
    azirshe (i < lines.length) {
        jasau line: jol = lines[i];
        jasau trimmed_line: jol = string_trim(line);
        
        // –ê–≥–≥–ª—é—Ç–∏–Ω–∞—Ç–∏–≤—Ç—ñ–∫ –∫—ñ–ª—Ç —Å”©–∑–¥–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä—É
        e–≥–µ—Ä (trimmed_line.startsWith("atqar") && !trimmed_line.contains("(")) {
            jasau error: LintError = lint_error_create();
            error.message = "atqar —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω–¥–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä –∂–æ“õ";
            error.line = i + 1;
            error.column = 1;
            errors = errors + [error];
        }
        
        e–≥–µ—Ä (trimmed_line.startsWith("jasau") && !trimmed_line.contains(":")) {
            jasau error: LintError = lint_error_create();
            error.message = "jasau –∞–π–Ω—ã–º–∞–ª—ã—Å—ã–Ω–¥–∞ —Ç–∏–ø –∂–æ“õ";
            error.line = i + 1;
            error.column = 1;
            errors = errors + [error];
        }
        
        i = i + 1;
    }
    
    qaytar errors;
}

// –°—Ç–∏–ª—å “õ–∞—Ç–µ–ª–µ—Ä—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É
atqar kompilyator_check_style(source_code: jol) -> LintError[] {
    jasau errors: LintError[] = [];
    jasau lines: jol[] = string_split(source_code, "\n");
    jasau i: san = 0;
    
    azirshe (i < lines.length) {
        jasau line: jol = lines[i];
        
        // –¢–∞—Ä—Ç—É–¥—ã —Ç–µ–∫—Å–µ—Ä—É (4 –±–æ—Å –æ—Ä—ã–Ω)
        e–≥–µ—Ä (line.startsWith("    ") && !line.startsWith("        ")) {
            jasau error: LintError = lint_error_create();
            error.message = "–¢–∞—Ä—Ç—É 4 –±–æ—Å –æ—Ä—ã–Ω –±–æ–ª—É—ã –∫–µ—Ä–µ–∫";
            error.line = i + 1;
            error.column = 1;
            errors = errors + [error];
        }
        
        // –ê–≥–≥–ª—é—Ç–∏–Ω–∞—Ç–∏–≤—Ç—ñ–∫ —Ñ—É–Ω–∫—Ü–∏—è –∞—Ç–∞—É–ª–∞—Ä—ã–Ω —Ç–µ–∫—Å–µ—Ä—É
        e–≥–µ—Ä (line.contains("atqar") && line.contains("_")) {
            jasau function_name: jol = kompilyator_extract_function_name(line);
            e–≥–µ—Ä (!kompilyator_is_agglutinative_name(function_name)) {
                jasau error: LintError = lint_error_create();
                error.message = "–§—É–Ω–∫—Ü–∏—è –∞—Ç–∞—É—ã –∞–≥–≥–ª—é—Ç–∏–Ω–∞—Ç–∏–≤—Ç—ñ–∫ –µ–º–µ—Å: " + function_name;
                error.line = i + 1;
                error.column = 1;
                errors = errors + [error];
            }
        }
        
        i = i + 1;
    }
    
    qaytar errors;
}

// –ê–≥–≥–ª—é—Ç–∏–Ω–∞—Ç–∏–≤—Ç—ñ–∫ –µ—Ä–µ–∂–µ–ª–µ—Ä–¥—ñ —Ç–µ–∫—Å–µ—Ä—É
atqar kompilyator_check_agglutinative_rules(source_code: jol) -> LintError[] {
    jasau errors: LintError[] = [];
    jasau lines: jol[] = string_split(source_code, "\n");
    jasau i: san = 0;
    
    azirshe (i < lines.length) {
        jasau line: jol = lines[i];
        
        // –ú–æ—Ä—Ñ–µ–º–∞–ª–∞—Ä–¥—ã —Ç–µ–∫—Å–µ—Ä—É
        e–≥–µ—Ä (line.contains("qosu") || line.contains("alu") || line.contains("jasau") || 
              line.contains("opt") || line.contains("eng") || line.contains("man")) {
            // –ú–æ—Ä—Ñ–µ–º–∞–ª–∞—Ä –¥“±—Ä—ã—Å “õ–æ–ª–¥–∞–Ω—ã–ª“ì–∞–Ω—ã–Ω —Ç–µ–∫—Å–µ—Ä—É
            jasau morph_errors: LintError[] = kompilyator_check_morphemes(line, i + 1);
            errors = errors + morph_errors;
        }
        
        // –§–æ–Ω–µ–º–∞–ª–∞—Ä–¥—ã —Ç–µ–∫—Å–µ—Ä—É
        e–≥–µ—Ä (line.contains("q") || line.contains("k") || line.contains("t") || 
              line.contains("s") || line.contains("r")) {
            jasau phon_errors: LintError[] = kompilyator_check_phonemes(line, i + 1);
            errors = errors + phon_errors;
        }
        
        i = i + 1;
    }
    
    qaytar errors;
}

// –ú–æ—Ä—Ñ–µ–º–∞–ª–∞—Ä–¥—ã —Ç–µ–∫—Å–µ—Ä—É
atqar kompilyator_check_morphemes(line: jol, line_number: san) -> LintError[] {
    jasau errors: LintError[] = [];
    
    // qosu –º–æ—Ä—Ñ–µ–º–∞—Å—ã–Ω —Ç–µ–∫—Å–µ—Ä—É
    e–≥–µ—Ä (line.contains("qosu") && !line.contains("_qosu")) {
        jasau error: LintError = lint_error_create();
        error.message = "qosu –º–æ—Ä—Ñ–µ–º–∞—Å—ã –¥“±—Ä—ã—Å “õ–æ–ª–¥–∞–Ω—ã–ª–º–∞“ì–∞–Ω";
        error.line = line_number;
        error.column = 1;
        errors = errors + [error];
    }
    
    // alu –º–æ—Ä—Ñ–µ–º–∞—Å—ã–Ω —Ç–µ–∫—Å–µ—Ä—É
    e–≥–µ—Ä (line.contains("alu") && !line.contains("_alu")) {
        jasau error: LintError = lint_error_create();
        error.message = "alu –º–æ—Ä—Ñ–µ–º–∞—Å—ã –¥“±—Ä—ã—Å “õ–æ–ª–¥–∞–Ω—ã–ª–º–∞“ì–∞–Ω";
        error.line = line_number;
        error.column = 1;
        errors = errors + [error];
    }
    
    qaytar errors;
}

// –§–æ–Ω–µ–º–∞–ª–∞—Ä–¥—ã —Ç–µ–∫—Å–µ—Ä—É
atqar kompilyator_check_phonemes(line: jol, line_number: san) -> LintError[] {
    jasau errors: LintError[] = [];
    
    // –§–æ–Ω–µ–º–∞–ª–∞—Ä–¥—ã“£ –¥“±—Ä—ã—Å —Ç—ñ–∑–±–µ–≥—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É
    e–≥–µ—Ä (line.contains("q") && line.contains("k")) {
        jasau q_pos: san = line.indexOf("q");
        jasau k_pos: san = line.indexOf("k");
        
        e–≥–µ—Ä (q_pos > k_pos) {
            jasau error: LintError = lint_error_create();
            error.message = "–§–æ–Ω–µ–º–∞–ª–∞—Ä –¥“±—Ä—ã—Å —Ç—ñ–∑–±–µ–∫—Ç–µ –µ–º–µ—Å (q, k)";
            error.line = line_number;
            error.column = 1;
            errors = errors + [error];
        }
    }
    
    qaytar errors;
}

// –§—É–Ω–∫—Ü–∏—è –∞—Ç–∞—É—ã–Ω –∞–ª—É
atqar kompilyator_extract_function_name(line: jol) -> jol {
    jasau atqar_pos: san = line.indexOf("atqar");
    e–≥–µ—Ä (atqar_pos == -1) {
        qaytar "";
    }
    
    jasau start_pos: san = atqar_pos + 6; // "atqar " ”©—Ç–∫—ñ–∑—É
    jasau end_pos: san = line.indexOf("(", start_pos);
    
    e–≥–µ—Ä (end_pos == -1) {
        end_pos = line.length;
    }
    
    jasau function_name: jol = line.substring(start_pos, end_pos);
    qaytar string_trim(function_name);
}

// –ê–≥–≥–ª—é—Ç–∏–Ω–∞—Ç–∏–≤—Ç—ñ–∫ –∞—Ç–∞—É–¥—ã —Ç–µ–∫—Å–µ—Ä—É
atqar kompilyator_is_agglutinative_name(name: jol) -> aqƒ±qat {
    // –ê–≥–≥–ª—é—Ç–∏–Ω–∞—Ç–∏–≤—Ç—ñ–∫ –µ—Ä–µ–∂–µ–ª–µ—Ä:
    // 1. –ú–æ—Ä—Ñ–µ–º–∞–ª–∞—Ä –±—ñ—Ä—ñ–∫—Ç—ñ—Ä—ñ–ª—É—ñ –∫–µ—Ä–µ–∫
    // 2. –§–æ–Ω–µ–º–∞–ª–∞—Ä –¥“±—Ä—ã—Å —Ç—ñ–∑–±–µ–∫—Ç–µ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫
    // 3. –ê—Ç–∞—É “õ–∞–∑–∞“õ —Ç—ñ–ª—ñ–Ω—ñ“£ –µ—Ä–µ–∂–µ–ª–µ—Ä—ñ–Ω–µ —Å”ô–π–∫–µ—Å –±–æ–ª—É—ã –∫–µ—Ä–µ–∫
    
    jasau morphemes: jol[] = ["qosu", "alu", "jasau", "opt", "eng", "man"];
    jasau i: san = 0;
    
    azirshe (i < morphemes.length) {
        e–≥–µ—Ä (name.contains(morphemes[i])) {
            qaytar jan;
        }
        i = i + 1;
    }
    
    qaytar jin;
}

// –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –∂–∞—Å–∞—É
atqar compiler_create() -> Compiler {
    jasau compiler: Compiler = Compiler();
    qaytar compiler;
}

// Lint result –∂–∞—Å–∞—É
atqar lint_result_create() -> LintResult {
    jasau result: LintResult = LintResult();
    result.errors = [];
    result.success = jan;
    qaytar result;
}

// Lint error –∂–∞—Å–∞—É
atqar lint_error_create() -> LintError {
    jasau error: LintError = LintError();
    error.message = "";
    error.line = 0;
    error.column = 0;
    qaytar error;
}

// String —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä—ã
atqar string_split(str: jol, delimiter: jol) -> jol[] {
    jasau result: jol[] = [];
    jasau current: jol = "";
    jasau i: san = 0;
    
    azirshe (i < str.length) {
        e–≥–µ—Ä (str[i] == delimiter[0]) {
            e–≥–µ—Ä (current != "") {
                result = result + [current];
                current = "";
            }
        } aitpese {
            current = current + str[i];
        }
        i = i + 1;
    }
    
    e–≥–µ—Ä (current != "") {
        result = result + [current];
    }
    
    qaytar result;
}

atqar string_trim(str: jol) -> jol {
    jasau start: san = 0;
    jasau end: san = str.length - 1;
    
    // –ë–∞—Å—ã–Ω–∞–Ω –±–æ—Å –æ—Ä—ã–Ω–¥–∞—Ä–¥—ã ”©—Ç–∫—ñ–∑—É
    azirshe (start < str.length && (str[start] == ' ' || str[start] == '\t')) {
        start = start + 1;
    }
    
    // –°–æ“£—ã–Ω–∞–Ω –±–æ—Å –æ—Ä—ã–Ω–¥–∞—Ä–¥—ã ”©—Ç–∫—ñ–∑—É
    azirshe (end >= 0 && (str[end] == ' ' || str[end] == '\t' || str[end] == '\n' || str[end] == '\r')) {
        end = end - 1;
    }
    
    qaytar str.substring(start, end + 1);
}

atqar string_indexOf(str: jol, substr: jol) -> san {
    jasau i: san = 0;
    azirshe (i <= str.length - substr.length) {
        jasau j: san = 0;
        jasau match: aqƒ±qat = jan;
        
        azirshe (j < substr.length) {
            e–≥–µ—Ä (str[i + j] != substr[j]) {
                match = jin;
                break;
            }
            j = j + 1;
        }
        
        e–≥–µ—Ä (match) {
            qaytar i;
        }
        
        i = i + 1;
    }
    
    qaytar -1;
}

atqar string_substring(str: jol, start: san, end: san) -> jol {
    jasau result: jol = "";
    jasau i: san = start;
    
    azirshe (i < end && i < str.length) {
        result = result + str[i];
        i = i + 1;
    }
    
    qaytar result;
}

